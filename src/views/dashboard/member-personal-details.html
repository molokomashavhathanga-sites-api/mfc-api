<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Portal</title>

    <!-- links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/dashboard/css/stylesdash.css" />
    <script src="https://kit.fontawesome.com/e6d1f98a15.js" crossorigin="anonymous"></script>

</head>
<body>
  <div class="app-shell">

  <!-- Sidebar -->
  <aside class="sidebar glass-card">
    <div class="d-flex align-items-center gap-3 mb-4">
      <div class="logo-circle">M</div>
      <div>
        <div class="text-white fw-semibold">MMS</div>
        <div class="small-note">Member Portal</div>
      </div>
    </div>

    <nav class="d-grid gap-2">
      <a class="nav-pill  text-decoration-none" href="/member/portal">
        <span><i class="fas fa-home"></i></span> <span>Overview</span>
      </a>
      <a class="nav-pill text-decoration-none" href="/member/activities">
        <span><i class="fa-solid fa-dumbbell"></i></span> <span>Activities</span>
      </a>
      <a class="nav-pill text-decoration-none" href="/member/nutrition">
        <span><i class="fa-solid fa-apple-whole"></i></span> <span>Nutrition</span>
      </a>
      <a class="nav-pill active text-decoration-none" href="/member/personal-details">
        <span><i class="fa-solid fa-id-card"></i></span> <span>Personal Details</span>
      </a>
      <a class="nav-pill text-decoration-none" href="/member/edit-profile">
        <span><i class="fa-solid fa-user-gear"></i></span> <span>Edit Profile</span>
      </a>
      <a class="nav-pill text-decoration-none" href="/member/billing">
        <span><i class="fa-solid fa-credit-card"></i></span> <span>Membership & Billing</span>
      </a>
      <a class="nav-pill text-decoration-none" href="/member/reports">
        <span><i class="fa-solid fa-chart-area"></i></span> <span>Reports</span>
      </a>
    </nav>

    <div class="mt-4 p-3 rounded-4 glass-card">
      <div class="fw-semibold mb-1 text-white">Quick Tip</div>
      <div class="small-note">
        Small progress daily beats “I’ll start Monday” every time.
      </div>
    </div>

    <div class="mt-4 small-note">
      Logged in as <span class="text-white" id="memberName">Member</span>
    </div>
  </aside>

  <!-- Backdrop for mobile -->
  <div class="backdrop" id="backdrop"></div>

  <!-- /member/personal-details -->
<main class="content">
  <!-- Topbar -->
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
    <div>
      <div class="d-flex align-items-center gap-2 mb-2">
        <button class="btn btn-outline-light sidebar-toggle" id="toggleSidebar" type="button">
          <i class="fa-solid fa-bars"></i> Menu
        </button>
      </div>

      <h1 class="h3 text-white mb-1">Personal Details</h1>
      <div class="muted">Keep your contact info, emergency details, and billing info up to date.</div>
    </div>

    <div class="d-flex gap-2 flex-wrap">
      <button class="btn btn-outline-light" type="button" id="printDetailsBtn">
        Print
      </button>
      <button class="btn btn-primary" type="button" id="savePersonalBtn">
        Save Changes
      </button>
    </div>
  </div>

  <!-- Quick status strip -->
  <section class="card glass-card rounded-4 shadow-sm mb-4">
    <div class="card-body p-4">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="small-note">Member ID</div>
          <div class="text-white fw-semibold" id="memberId">M-0001</div>
        </div>
        <div class="col-md-4">
          <div class="small-note">Primary Contact</div>
          <div class="text-white fw-semibold" id="primaryPhone">+27 00 000 0000</div>
        </div>
        <div class="col-md-4">
          <div class="small-note">Next of Kin</div>
          <div class="text-white fw-semibold" id="nokSummary">Not set</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Accordion sections (mobile-friendly) -->
  <div class="accordion" id="personalAccordion">

    <!-- Contact & Address -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseContact">
          <i class="fa-solid fa-location-dot me-2"></i> Contact & Address
        </button>
      </h2>
      <div id="collapseContact" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small-note">Phone Number</label>
              <input class="form-control" id="phone" placeholder="+27 ..." />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Alternate Phone (optional)</label>
              <input class="form-control" id="altPhone" placeholder="+27 ..." />
            </div>

            <div class="col-12">
              <label class="form-label small-note">Street Address</label>
              <input class="form-control" id="street" placeholder="House no, street name" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">City</label>
              <input class="form-control" id="city" placeholder="e.g. Johannesburg" />
            </div>

            <div class="col-md-3">
              <label class="form-label small-note">Province</label>
              <select class="form-select" id="province">
                <option value="">Select</option>
                <option>Gauteng</option>
                <option>KwaZulu-Natal</option>
                <option>Western Cape</option>
                <option>Eastern Cape</option>
                <option>Free State</option>
                <option>Limpopo</option>
                <option>Mpumalanga</option>
                <option>North West</option>
                <option>Northern Cape</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label small-note">Postal Code</label>
              <input class="form-control" id="postalCode" placeholder="e.g. 2001" />
            </div>

            <div class="col-12">
              <label class="form-label small-note">Notes (optional)</label>
              <textarea class="form-control" id="addressNotes" rows="2"
                placeholder="e.g. Gate code, delivery notes..."></textarea>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Emergency Contacts -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseEmergency">
          <i class="fa-solid fa-triangle-exclamation me-2"></i> Emergency Contacts / Next of Kin
        </button>
      </h2>
      <div id="collapseEmergency" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="d-flex flex-column flex-md-row gap-2 align-items-md-center justify-content-between mb-3">
            <div>
              <div class="text-white fw-semibold">Emergency Contact(s)</div>
              <div class="small-note">Add at least one person we can contact if needed.</div>
            </div>
            <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#addEmergencyModal">
              + Add Contact
            </button>
          </div>

          <div class="table-responsive">
            <table class="table table-dark table-hover align-middle mb-0">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Relationship</th>
                  <th>Phone</th>
                  <th>Priority</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody id="emergencyTable">
                <tr>
                  <td class="text-white">—</td>
                  <td class="small-note">—</td>
                  <td class="small-note">—</td>
                  <td><span class="badge text-bg-secondary">None</span></td>
                  <td class="text-end">
                    <button class="btn btn-outline-light btn-sm" disabled>Edit</button>
                    <button class="btn btn-outline-danger btn-sm" disabled>Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="small-note mt-3">
            Tip: Set “Primary” for the person you want us to call first.
          </div>

        </div>
      </div>
    </div>

    <!-- Billing / Payment -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseBilling">
          <i class="fa-solid fa-credit-card me-2"></i> Billing & Payment Details
        </button>
      </h2>
      <div id="collapseBilling" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small-note">Preferred Payment Method</label>
              <select class="form-select" id="paymentMethod">
                <option value="">Select</option>
                <option value="eft">EFT</option>
                <option value="cash">Cash</option>
                <option value="debit">Debit Order</option>
                <option value="card">Card (not stored)</option>
              </select>
              <div class="small-note mt-2">
                We don’t store card numbers here — only payment status and references.
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Billing Email</label>
              <input class="form-control" id="billingEmail" placeholder="e.g. you@email.com" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Billing Reference (optional)</label>
              <input class="form-control" id="billingRef" placeholder="e.g. INV-1042 / Member Ref" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">VAT/Company (optional)</label>
              <input class="form-control" id="companyVat" placeholder="Company name / VAT no." />
            </div>

            <div class="col-12">
              <label class="form-label small-note">Billing Address (optional)</label>
              <textarea class="form-control" id="billingAddress" rows="2"
                placeholder="If different from home address..."></textarea>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Health Notes (non-graphic, safety focused) -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseHealth">
          <i class="fa-solid fa-heart-pulse me-2"></i> Health Notes (Optional)
        </button>
      </h2>
      <div id="collapseHealth" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small-note">Medical Conditions (optional)</label>
              <input class="form-control" id="medicalConditions" placeholder="e.g. asthma, hypertension..." />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Injuries / Limitations (optional)</label>
              <input class="form-control" id="injuries" placeholder="e.g. knee pain, shoulder limitation..." />
            </div>

            <div class="col-12">
              <label class="form-label small-note">Notes (optional)</label>
              <textarea class="form-control" id="healthNotes" rows="3"
                placeholder="Anything your trainer should know (safe & relevant)."></textarea>
              <div class="small-note mt-2">
                This is informational only — not medical advice.
              </div>
            </div>

            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="consentShareTrainer">
                <label class="form-check-label" for="consentShareTrainer">
                  I consent to share these notes with my trainer
                </label>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

  <!-- Add Emergency Contact Modal -->
  <div class="modal fade" id="addEmergencyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content glass-card">
        <div class="modal-header border-0">
          <h5 class="modal-title text-white">Add Emergency Contact</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label small-note">Full Name</label>
              <input class="form-control" id="ecName" placeholder="e.g. Thando Msimango" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Relationship</label>
              <input class="form-control" id="ecRelationship" placeholder="e.g. Parent, Spouse, Sibling" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Phone</label>
              <input class="form-control" id="ecPhone" placeholder="+27 ..." />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Priority</label>
              <select class="form-select" id="ecPriority">
                <option value="primary">Primary</option>
                <option value="secondary" selected>Secondary</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Notes (optional)</label>
              <input class="form-control" id="ecNotes" placeholder="e.g. available after 5pm" />
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" id="saveEmergencyBtn">Save</button>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  // Minimal UI wiring (hook API later)
  document.getElementById("savePersonalBtn")?.addEventListener("click", () => {
    alert("Personal details saved (hook API next).");
  });

  document.getElementById("printDetailsBtn")?.addEventListener("click", () => window.print());

  document.getElementById("saveEmergencyBtn")?.addEventListener("click", () => {
    const name = document.getElementById("ecName")?.value?.trim();
    const rel = document.getElementById("ecRelationship")?.value?.trim();
    const phone = document.getElementById("ecPhone")?.value?.trim();
    const priority = document.getElementById("ecPriority")?.value;

    if (!name || !phone) {
      alert("Please enter at least a name and phone number.");
      return;
    }

    const tbody = document.getElementById("emergencyTable");
    const badge = priority === "primary" ? "text-bg-primary" : "text-bg-secondary";

    // Remove placeholder row if present
    const placeholder = tbody.querySelector("tr td")?.textContent?.trim() === "—";
    if (placeholder) tbody.innerHTML = "";

    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="text-white">${name}</td>
      <td class="small-note">${rel || "—"}</td>
      <td class="small-note">${phone}</td>
      <td><span class="badge ${badge}">${priority}</span></td>
      <td class="text-end">
        <button class="btn btn-outline-light btn-sm" type="button">Edit</button>
        <button class="btn btn-outline-danger btn-sm" type="button">Delete</button>
      </td>
    `;
    tbody.prepend(row);

    // Update summary
    document.getElementById("nokSummary").textContent =
      priority === "primary" ? `${name} (Primary)` : `${name}`;

    // Close modal (Bootstrap)
    const modalEl = document.getElementById("addEmergencyModal");
    const modal = bootstrap.Modal.getInstance(modalEl);
    modal?.hide();

    // Reset fields
    ["ecName","ecRelationship","ecPhone","ecNotes"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = "";
    });
    document.getElementById("ecPriority").value = "secondary";
  });
</script>
</div>
</body>
</html>